{% extends "image/base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- 업로드 폼 -->
    <div class="bg-white p-6 rounded-lg shadow-md mb-8">
        <h2 class="text-2xl font-bold mb-4">이미지 업로드</h2>
        <form id="uploadForm" class="space-y-4">
            <div class="flex items-center space-x-4">
                <input type="file" 
                       id="imageInput" 
                       accept="image/*"
                       class="flex-1 p-2 border rounded">
                <button type="submit" 
                        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                    업로드
                </button>
            </div>
        </form>
    </div>

    <!-- 이미지 목록 -->
    <div class="bg-white p-6 rounded-lg shadow-md">
        <h2 class="text-2xl font-bold mb-4">이미지 목록</h2>
        <div id="imageList" class="grid grid-cols-3 gap-4">
            <!-- 이미지들이 여기에 동적으로 로드됩니다 -->
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // 이미지 목록 로드
    function loadImages() {
        fetch('/api/images/list')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const imageList = document.getElementById('imageList');
                    imageList.innerHTML = '';
                    
                    data.data.forEach(image => {
                        const div = document.createElement('div');
                        div.className = 'relative group';
                        div.innerHTML = `
                            <img src="${image.image_url}" 
                                 alt="업로드된 이미지" 
                                 class="w-full h-48 object-cover rounded-lg">
                            <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-50 text-white p-2 text-sm">
                                ${new Date(image.created_at).toLocaleDateString()}
                            </div>
                        `;
                        imageList.appendChild(div);
                    });
                }
            });
    }

    // 이미지 업로드
    document.getElementById('uploadForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const fileInput = document.getElementById('imageInput');
        const formData = new FormData();
        formData.append('file', fileInput.files[0]);  // 'image'를 'file'로 변경

        fetch('/api/images/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                loadImages();
                fileInput.value = '';
            } else {
                alert('업로드 실패: ' + data.message);
            }
        });
    });

    // 초기 이미지 목록 로드
    loadImages();
});
</script>
{% endblock %}
